## 1.制定规则

## 正如冯鑫学长说的，既然我们要实现聊天室，首先就应该规定好我们客户端与服务器之间的“通信协议”，也就是拟定一套自己的规则，让服务器能清晰的知道你想要干什么并能够作出相应的处理。

## 聊天室由于发送的消息比较系统，拿一个私聊来说吧，我们要进行私聊，并不可能只给服务器一条你要发送的信息，在进行私聊的过程中，我们最少需要一次性告诉服务器我是谁，我说了什么，我要发给谁。这时候我们必须用结构体，要不然你准备一个私聊写多少个send与recv？

## 当然结构体的设计不可能这么简单，因为我们不可能只有私聊这一个功能，所以就需要你们仔细设计结构体，然后，刚开始不要就想着一下把结构体设计好，所有东西都是先开始设计最简单，最核心的部分，然后你们需要啥功能，自己向结构体里面再进行封装就行了，最后服务器就可以跟据这个结构体将你想要实现的任何功能进行判断然后作出相应的处理。（要进行功能的判断，其中当然少不了标志位，那么我们那么多功能，你用一个标志位当然可以处理，但很麻烦，所以建议你们设计结构体嵌套的时候，也将标志位进行嵌套，这样就有了层级关系，思路也就更加清晰）

## 至于冯鑫学长说的分包与粘包，我昨天没听，我去年也没有这个坑，所以你们有任何疑惑的话，及时问你们冯鑫学长。

---
## 2.C/S整体架构

## 首先我们来谈一谈服务器端吧，由于聊天室只有登录与注册是和服务器进行单方面的交互，就和书本上面的那个例子一样。所以你们可以将这两个功能与开始进行聊天界面之后所要实现的功能进行区分，我去年也是这样做的，但是今年我并不建议你这样做，因为这样写出来的代码给人的感觉就是不完美，明明可以全部统一起来，你却进行了划分。

## 然后我们就要在服务器这边进行逻辑处理了，很简单啊，让服务器一直处于监听状态，我不知道这样描述是否准确，但你们应该可以理解我的意思。只要有客户端进行链接请求，你们就给其开辟一个线程，这个线程里面所要处理的就是，接受客户端发送过来的请求（也就是结构体），进行解析，并作出相应的处理。（难道还要有其他操作吗？）

## 如果你使用的epoll，好吧，我并不会。。。问一下肖孟，康康，冯鑫学长等。他们很乐意解决你的问题。

## 咱们组的两个学姐去年的聊天室也写的特别好，所以你们有问题也可以问她们，我是最水的。。。所以我很可能爱莫能助，但是我也会认真的给你改bug，尽我最大的努力。。。

## 注意，服务器端这边模型非常多，epoll单线程，epoll多线程，我给你们介绍的就只是简单的多线程，我去年也只是使用简单的多线程。如果你们想要了解其他模型，就去翻阅资料，以及和学长进行讨论。

---
## 我们在来看一下客户端，好吧，这是不是你们最头疼的了？去年也是最让我头疼的了。那么如果我现在说客户端的实现其实比服务器端还要简单呢。你问我为什么？服务器端那么多线程，而客户端只需要两个线程，而且处理流程基本没有什么区别。

## 仔细想一想，我们的客户端就需要两个功能，我能发消息，我能收消息。这不就完了吗？而服务器不仅要确保能收到你的消息，并且要对其进行正确的解析然后发送给正确的人。明显服务器这边要麻烦。

## 那么既然我们客户端需要发消息，收消息，仔细想一想这两个事件的特征，发消息肯定是我随时随刻想发就发，而收消息就只是一瞬间的事件。因此！我们肯定将收消息这一功能放在子线程中，并且这个线程就一个作用，一直在进行recv阻塞，当只有消息到来的时候这个线程才会工作，当然也不是说这个线程就真的只是在那循环recv。在收到消息之后，肯定也要进行逻辑业务的处理，这个消息是什么类型，该以什么样的格式进行显示，甚至说它目前不给你显示完整消息，而只是告诉你，哦，你有一条来自谁的未读消息，请注意查收，然后你必须进入与这个人的聊天界面才能看到这个消息等等功能，都是需要你进行考虑的，而且，明显后面我所说的才是正确的显示方式。所以你们写聊天室的时候也要注意尽量开发出符合正常逻辑的功能。（参考QQ是最好的办法）

## 最后给你们强调一点，recv线程里面不要出现scanf，因为scanf也具有阻塞功能，如果你使用了scanf，那么当前线程又会阻塞，这时候如果你的主线程也有scanf，那么输入的东西相当于是主线程的scanf在和子线程的scanf进行抢占，至于最后谁会拿到输入值，这当然是不好说的。

---

## 总结

## 写聊天室的过程中不要着急，还有，这算起来离你们正式离校还有8天的时间，你们要静下心来，就算21号回家，只要你在学校把聊天室做的差不多了，你们回去也还有10天左右的时间是没有压力的去狂玩，也不用在意家长的想法，毕竟你都学了一暑假了。所以加油，你们肯定可以的，因为这东西真的不难！

## 有问题你们要及时讨论，不要只在小小组内讨论，我们是open， free， share，所以尽量多进行思想的碰撞，才能写出好的代码。（有问题及时问学长！！！我不会也会帮你们找会的学长！！！）

## 大体思路就是这样，感觉应该解决了你们目前最疑惑的问题。关键还是要自己进行思考，每次动手写之前最好考虑自己这种方式到最后是否可行。
